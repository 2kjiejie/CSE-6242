<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Rebrickable Lego Sets by Year</title>
        <script type="text/javascript" src=".\lib\d3\d3.min.js"></script>
        <script type="text/javascript" src=".\lib\d3-dsv\d3-dsv.min.js"></script>
        <script type="text/javascript" src=".\lib\d3-fetch\d3-fetch.min.js"></script>
    </head>
    <body>
		<div id="barplot"></div>
        <script type="text/javascript">
            // Your beautiful D3 code will go here  
		/*
		d3.dsv(",", "q3.csv", function(d) {
		  return {
			year: d.Year, // convert "Year" column to Date
			running_tota: d.running_total
		  };
		}).then(function(data) {
		  console.log(data);
		});    
		 */
		var margin = {top: 120, right: 30, bottom: 70, left: 100},
		width = 1000 - margin.left - margin.right,
		height = 600 - margin.top - margin.bottom;
		
		var svg = d3.select("#barplot")
		.append("svg")
		.attr("width", width + margin.left + margin.right)
		.attr("height", height + margin.top + margin.bottom)
		.append("g")
		.attr("transform",
			  "translate(" + margin.left + "," + margin.top + ")");

		d3.dsv(",","./q3.csv").then(
				
		function (data) {
			/* 
			var x = d3.scaleBand()
			.range([ 0, width ])
			.domain(data.map(function(d) { return d.year; }))
			.padding(0.2);
			*/
			years = data.map(function(d){return +d.year});
			//running_total = data.map(function(d){return parseInt(d.running_total)});
			
			var x = d3.scaleTime()
			.domain([new Date(d3.min(years),0,1,0,0,0,0),new Date(d3.max(years),0,1,0,0,0,0)])
			.range([ 0, width ])


			var y = d3.scaleLinear()
				.domain([0, d3.max(data.map(function(d) { return parseInt(d.running_total)}))])
				.range([ height, 0]);
	/*		  svg.append("g")
				  .attr("transform", "translate(0," + height + ")")
				  .call(xAxis);*/

			  // add the y Axis

		
		svg.selectAll("mybar")
		.data(data)
		.enter()
		.append("rect")
		.attr("x", function(d) { 
			//console.log(x(d.year));
			return x(new Date(d.year)); })
		.attr("y", function(d) { return y(parseInt(d.running_total));})
		.attr("class", "bar")
		.attr("width", 10)
		.attr("height", function(d) { return height - y(parseInt(d.running_total)); })
		.attr("fill", "#69b3a2");
	
		svg.append("g")
		.attr("transform", "translate(0," + height + ")")
		.call(d3.axisBottom(x).ticks(d3.timeYear.every(3)))
		.selectAll("text")
		.attr("transform", "translate(-10,0)rotate(-45)")
		.style("text-anchor", "end");
		
		svg.append("g")
			  .call(d3.axisLeft(y));
		})







		
        </script>
    </body>
</html>
